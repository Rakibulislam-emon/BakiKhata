(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{754:function(e,t,s){Promise.resolve().then(s.bind(s,4672))},4672:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var a=s(7437);let r=(0,s(7327).eI)("https://oxcumomcgnjdnnonilti.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94Y3Vtb21jZ25qZG5ub25pbHRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMTgwNTIsImV4cCI6MjA4MjY5NDA1Mn0.4m1ioq1Q6sXL5LA5lODTIpU6Ysj0-PE0zw2Rp2jQiI0");var n=s(2265),l=s(4817),i=s(2513);let c=e=>new Date(e).toLocaleDateString("bn-BD",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),d=e=>new Date(e).toLocaleDateString("bn-BD",{day:"numeric",month:"short",year:"numeric"}),o=e=>new Intl.NumberFormat("bn-BD",{style:"currency",currency:"BDT",maximumFractionDigits:0}).format(e),m=()=>new Date().toISOString(),x=e=>{let{type:t,message:s}=e;return(0,a.jsx)("div",{className:"fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ".concat("success"===t?"bg-green-500":"bg-red-500"," text-white"),children:s})};var u=s(9162),h=s(3225),g=s(1568),p=s(2468);let j=e=>{let{totalBaki:t,totalPaid:s,transactionCount:r,customerCount:n}=e;return(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card card-hover",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)(u.Z,{className:"w-6 h-6 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"মোট বাকি"}),(0,a.jsx)("p",{className:"text-xl font-bold text-red-600",children:o(t)})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card card-hover",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(h.Z,{className:"w-6 h-6 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"পরিশোধিত"}),(0,a.jsx)("p",{className:"text-xl font-bold text-green-600",children:o(s)})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card card-hover",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-100 rounded-lg",children:(0,a.jsx)(g.Z,{className:"w-6 h-6 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"মোট লেনদেন"}),(0,a.jsx)("p",{className:"text-xl font-bold text-orange-600",children:r})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card card-hover",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(p.Z,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"গ্রাহক"}),(0,a.jsx)("p",{className:"text-xl font-bold text-blue-600",children:n})]})]})})]})})};var f=s(4697);let N=e=>{let{formData:t,setFormData:s,onSubmit:r,onCancel:n}=e;return(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-card",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800",children:"নতুন বিল যোগ করুন"}),(0,a.jsxs)("form",{onSubmit:r,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"গ্রাহকের নাম *"}),(0,a.jsx)("input",{type:"text",value:t.name,onChange:e=>s({...t,name:e.target.value}),placeholder:"উদাহরণ: রাকিব",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all",required:!0,autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"টাকার পরিমাণ (টাকা) *"}),(0,a.jsx)("input",{type:"number",value:t.amount,onChange:e=>s({...t,amount:e.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"নোট (ঐচ্ছিক)"}),(0,a.jsx)("textarea",{value:t.notes,onChange:e=>s({...t,notes:e.target.value}),placeholder:"অতিরিক্ত তথ্য...",rows:2,className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all resize-none"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-all font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5"}),"যোগ করুন"]}),(0,a.jsxs)("button",{type:"button",onClick:n,className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition-all font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(f.Z,{className:"w-5 h-5"}),"বাতিল"]})]})]})]})})},b=e=>{let{customerSummaries:t,searchTerm:s,onSelectCustomer:r}=e,n=t.filter(e=>e.name.toLowerCase().includes(s.toLowerCase()));return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"\uD83D\uDCCA গ্রাহকের বাকির হিসাব"}),0===t.length?(0,a.jsxs)("div",{className:"bg-white rounded-xl p-12 text-center shadow-card",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCED"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"কোনো গ্রাহক নেই"}),(0,a.jsx)("p",{className:"text-gray-500",children:"উপরের বাটনে ক্লিক করে নতুন বিল যোগ করুন"})]}):(0,a.jsx)("div",{className:"space-y-4",children:n.map(e=>{let t=e.transactions.filter(e=>!e.isPaid).reduce((e,t)=>e+t.amount,0),s=e.transactions.filter(e=>!e.isPaid).length,n=e.transactions.filter(e=>e.isPaid).length;return(0,a.jsx)("div",{onClick:()=>r(e.name),className:"bg-white rounded-xl p-4 shadow-card card-hover cursor-pointer transition-all",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-full flex items-center justify-center text-white font-bold text-xl ".concat(t>0?"bg-orange-500":"bg-green-500"),children:e.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["শেষ লেনদেন: ",d(e.lastTransaction)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["মোট বিল: ",e.transactions.length,"টি | বাকি:"," ",s,"টি | পরিশোধিত: ",n,"টি"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-2xl font-bold ".concat(t>0?"text-red-600":"text-green-600"),children:o(t)}),(0,a.jsx)("p",{className:"text-sm ".concat(t>0?"text-red-500":"text-green-500"),children:t>0?"বাকি":"সব পরিশোধিত"})]})]})},e.name)})})]})};var w=s(883),v=s(933);let y=e=>{let{transactions:t,onClearRecent:s,onDeleteTransaction:r}=e;return 0===t.length?null:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 mt-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"\uD83D\uDD50 সাম্প্রতিক লেনদেন"}),(0,a.jsxs)("button",{onClick:s,className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-all flex items-center gap-2 text-sm font-medium",title:"সব মুছুন",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),"সব মুছুন"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card ".concat(e.isPaid?"opacity-60":""),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat(e.isPaid?"bg-green-100":"bg-red-100"),children:e.isPaid?(0,a.jsx)(p.Z,{className:"w-4 h-4 text-green-600"}):(0,a.jsx)(u.Z,{className:"w-4 h-4 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-800",children:e.customerName}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[(0,a.jsx)(v.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:c(e.date)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("p",{className:"font-bold ".concat(e.isPaid?"text-green-600 line-through":"text-red-600"),children:o(e.amount)}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("আপনি কি নিশ্চিত যে এই বিল মুছে ফেলতে চান?")&&r(e.id)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"মুছুন",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]})]})},e.id))})]})};var C=s(5137),D=s(374),P=s(2555);let _=e=>{let{customer:t,totals:s,onBack:r,onDeleteAll:n,onToggleAllPaid:l,onTogglePaid:d,onDeleteTransaction:m,onDeleteAllPaid:x,showAddForm:u,setShowAddForm:h,formData:g,setFormData:p,onSubmit:j}=e;if(!t||!s)return null;let f=t.transactions.filter(e=>!e.isPaid),N=t.transactions.filter(e=>e.isPaid),b=f.length>0;return(0,a.jsxs)("div",{className:"min-h-screen pb-20",children:[(0,a.jsx)("header",{className:"bg-gradient-to-r from-green-600 to-green-500 text-white py-4 px-4 shadow-lg",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:(0,a.jsx)(C.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:t.name}),(0,a.jsx)("p",{className:"text-green-100 text-sm",children:"সম্পূর্ণ লেনদেনের তালিকা"})]})]}),(0,a.jsx)("button",{onClick:n,className:"p-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors",title:"সব মুছুন",children:(0,a.jsx)(w.Z,{className:"w-5 h-5"})})]})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-4",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("p",{className:"text-green-100",children:"বর্তমান বাকি"}),(0,a.jsx)("p",{className:"text-5xl font-bold",children:o(s.totalBaki)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white/10 rounded-xl p-3 text-center",children:[(0,a.jsx)("p",{className:"text-green-200 text-sm",children:"মোট বিল"}),(0,a.jsxs)("p",{className:"text-xl font-bold",children:[t.transactions.length,"টি"]})]}),(0,a.jsxs)("div",{className:"bg-white/10 rounded-xl p-3 text-center",children:[(0,a.jsx)("p",{className:"text-green-200 text-sm",children:"বাকি আছে"}),(0,a.jsxs)("p",{className:"text-xl font-bold",children:[s.unpaidCount,"টি"]})]}),(0,a.jsxs)("div",{className:"bg-white/10 rounded-xl p-3 text-center",children:[(0,a.jsx)("p",{className:"text-green-200 text-sm",children:"পরিশোধিত"}),(0,a.jsxs)("p",{className:"text-xl font-bold",children:[s.paidCount,"টি"]})]})]})]})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-card",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-4 text-gray-800 flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5 text-green-600"}),"নতুন বিল যোগ করুন"]}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"টাকার পরিমাণ (টাকা) *"}),(0,a.jsx)("input",{type:"number",value:g.amount,onChange:e=>p({...g,amount:e.target.value}),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"নোট (ঐচ্ছিক)"}),(0,a.jsx)("textarea",{value:g.notes,onChange:e=>p({...g,notes:e.target.value}),placeholder:"অতিরিক্ত তথ্য...",rows:2,className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all resize-none"})]}),(0,a.jsxs)("button",{type:"submit",className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-all font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5"}),"যোগ করুন"]})]})]})}),f.length>0&&(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-red-500 rounded-full"}),"বাকি বিল (",f.length,"টি)"]}),(0,a.jsxs)("button",{onClick:l,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all text-sm font-medium",children:[b?(0,a.jsx)(D.Z,{className:"w-4 h-4"}):(0,a.jsx)(P.Z,{className:"w-4 h-4"}),"সব পরিশোধ করুন"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card border-l-4 border-red-500",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.isPaid,onChange:()=>d(e.id),className:"w-6 h-6 rounded border-2 border-red-500 text-red-500 focus:ring-red-500 cursor-pointer"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xl font-bold text-red-600",children:o(e.amount)}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500 mt-1",children:[(0,a.jsx)(v.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:c(e.date)})]}),e.notes&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["\uD83D\uDCDD ",e.notes]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("button",{onClick:()=>m(e.id),className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-all",title:"মুছুন",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})})]})})]})},e.id))})]}),N.length>0&&(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),"পরিশোধিত বিল (",N.length,"টি)"]}),(0,a.jsxs)("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition-all text-sm font-medium",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),"সব মুছুন"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:N.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-card border-l-4 border-green-500 opacity-75",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.isPaid,onChange:()=>d(e.id),className:"w-6 h-6 rounded border-2 border-green-500 text-green-500 focus:ring-green-500 cursor-pointer"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xl font-bold text-green-600 line-through",children:o(e.amount)}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500 mt-1",children:[(0,a.jsx)(v.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:c(e.date)})]})]}),(0,a.jsx)("button",{onClick:()=>m(e.id),className:"p-2 bg-gray-100 text-gray-400 rounded-lg hover:bg-red-100 hover:text-red-600 transition-all",title:"মুছুন",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]})})]})},e.id))})]}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-8",children:(0,a.jsxs)("button",{onClick:n,className:"w-full py-4 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all font-medium flex items-center justify-center gap-2 shadow-lg",children:[(0,a.jsx)(w.Z,{className:"w-5 h-5"}),"All Clear - এই গ্রাহকের সব বিল মুছুন"]})}),(0,a.jsx)("footer",{className:"max-w-4xl mx-auto px-4 mt-12 text-center text-gray-500 text-sm",children:(0,a.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," বাকি হিসাব"]})})]})};function k(){let[e,t]=(0,n.useState)([]),[s,c]=(0,n.useState)({name:"",amount:"",notes:""}),[d,o]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1),[g,p]=(0,n.useState)(null),[f,w]=(0,n.useState)(null);(0,n.useEffect)(()=>{v()},[]);let v=async()=>{let{data:e,error:s}=await r.from("transactions").select("*").order("date",{ascending:!1});if(s){console.error("Error fetching transactions:",s),C("error","ডাটা লোড করতে সমস্যা হয়েছে");return}e&&t(e.map(e=>({id:e.id,customerName:e.customer_name,amount:e.amount,isPaid:e.is_paid,date:e.date,notes:e.notes,createdAt:e.created_at,isHiddenFromRecent:e.is_hidden_from_recent})))},C=(e,t)=>{p({type:e,message:t}),setTimeout(()=>p(null),3e3)},D=async e=>{e.preventDefault();let a=f||s.name.trim();if(!a||!s.amount){C("error","দয়া করে নাম এবং টাকার পরিমাণ লিখুন");return}let n=parseFloat(s.amount);if(isNaN(n)||n<=0){C("error","সঠিক টাকার পরিমাণ লিখুন");return}let l={customer_name:a,amount:n,is_paid:!1,date:m(),notes:s.notes.trim(),created_at:m(),is_hidden_from_recent:!1},{data:i,error:d}=await r.from("transactions").insert([l]).select().single();if(d){console.error("Error adding transaction:",d),C("error","বিল যোগ করতে সমস্যা হয়েছে");return}if(i){let e={id:i.id,customerName:i.customer_name,amount:i.amount,isPaid:i.is_paid,date:i.date,notes:i.notes,createdAt:i.created_at,isHiddenFromRecent:i.is_hidden_from_recent};t(t=>[e,...t]),c(e=>({...e,amount:"",notes:""})),f||c({name:"",amount:"",notes:""}),h(!1),C("success","বিল যোগ হয়েছে")}},P=async s=>{let a=e.find(e=>e.id===s);if(!a)return;let n=!a.isPaid;t(e=>e.map(e=>e.id===s?{...e,isPaid:n}:e));let{error:l}=await r.from("transactions").update({is_paid:n}).eq("id",s);l&&(console.error("Error updating transaction:",l),C("error","আপডেট করতে সমস্যা হয়েছে"),t(e=>e.map(e=>e.id===s?{...e,isPaid:!n}:e)))},k=async()=>{if(!f)return;let e=F(f).transactions.filter(e=>!e.isPaid).length>0;t(t=>t.map(t=>t.customerName.toLowerCase()===f.toLowerCase()?{...t,isPaid:e}:t));let{error:s}=await r.from("transactions").update({is_paid:e}).ilike("customer_name",f);s&&(console.error("Error updating all:",s),C("error","আপডেট করতে সমস্যা হয়েছে"),v())},Z=async s=>{if(confirm("আপনি কি নিশ্চিত যে এই বিল মুছে ফেলতে চান?")){let a=[...e];t(e=>e.filter(e=>e.id!==s));let{error:n}=await r.from("transactions").delete().eq("id",s);n?(console.error("Error deleting transaction:",n),C("error","মুছতে সমস্যা হয়েছে"),t(a)):C("success","বিল মুছে ফেলা হয়েছে")}},T=async()=>{if(!f||!confirm("আপনি কি নিশ্চিত যে ".concat(f,"-এর সব বিল মুছে ফেলতে চান?")))return;let s=[...e];t(e=>e.filter(e=>e.customerName.toLowerCase()!==f.toLowerCase()));let{error:a}=await r.from("transactions").delete().ilike("customer_name",f);a?(console.error("Error deleting all:",a),C("error","মুছতে সমস্যা হয়েছে"),t(s)):(w(null),C("success","সব বিল মুছে ফেলা হয়েছে"))},I=async()=>{if(!f||!confirm("আপনি কি নিশ্চিত যে ".concat(f,"-এর সব পরিশোধিত বিল মুছে ফেলতে চান?")))return;let s=[...e];t(e=>e.filter(e=>!(e.customerName.toLowerCase()===f.toLowerCase()&&e.isPaid)));let{error:a}=await r.from("transactions").delete().match({is_paid:!0}).ilike("customer_name",f);a?(console.error("Error deleting all paid:",a),C("error","মুছতে সমস্যা হয়েছে"),t(s)):C("success","সব পরিশোধিত বিল মুছে ফেলা হয়েছে")},L=async()=>{if(confirm("আপনি কি নিশ্চিত যে সাম্প্রতিক লেনদেনের তালিকা মুছে ফেলতে চান? (মূল হিসাব ঠিক থাকবে)")){let e=M.map(e=>e.id);t(t=>t.map(t=>e.includes(t.id)?{...t,isHiddenFromRecent:!0}:t));let{error:s}=await r.from("transactions").update({is_hidden_from_recent:!0}).in("id",e);s?(console.error("Error clearing recent:",s),C("error","সমস্যা হয়েছে"),v()):C("success","সাম্প্রতিক তালিকা পরিষ্কার করা হয়েছে")}},S=(0,n.useMemo)(()=>{let t=new Map;e.forEach(e=>{let s=e.customerName.toLowerCase().trim();t.has(s)||t.set(s,[]),t.get(s).push(e)});let s=[];return t.forEach((e,t)=>{var a;let r=e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());s.push({name:e[0].customerName,transactions:r,lastTransaction:(null===(a=r[0])||void 0===a?void 0:a.date)||""})}),s.sort((e,t)=>new Date(t.lastTransaction).getTime()-new Date(e.lastTransaction).getTime())},[e]),E=(0,n.useMemo)(()=>{if(!f)return null;let t=e.filter(e=>e.customerName.toLowerCase()===f.toLowerCase());if(0===t.length)return null;let s=t.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return{name:t[0].customerName,transactions:s}},[f,e]),F=t=>{var s,a;let r=e.filter(e=>e.customerName.toLowerCase()===t.toLowerCase()),n=r.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return{name:(null===(s=r[0])||void 0===s?void 0:s.customerName)||t,transactions:n,lastTransaction:(null===(a=n[0])||void 0===a?void 0:a.date)||""}},A=(0,n.useMemo)(()=>{if(!E)return null;let e=E.transactions.filter(e=>!e.isPaid).reduce((e,t)=>e+t.amount,0);return{totalBaki:e,totalPaid:E.transactions.filter(e=>e.isPaid).reduce((e,t)=>e+t.amount,0),unpaidCount:E.transactions.filter(e=>!e.isPaid).length,paidCount:E.transactions.filter(e=>e.isPaid).length}},[E]),M=(0,n.useMemo)(()=>e.filter(e=>e.customerName.toLowerCase().includes(d.toLowerCase())&&!e.isHiddenFromRecent).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,5),[e,d]),B=(0,n.useMemo)(()=>e.filter(e=>!e.isPaid).reduce((e,t)=>e+t.amount,0),[e]),R=(0,n.useMemo)(()=>e.filter(e=>e.isPaid).reduce((e,t)=>e+t.amount,0),[e]);return E&&A?(0,a.jsxs)(a.Fragment,{children:[g&&(0,a.jsx)(x,{type:g.type,message:g.message}),(0,a.jsx)(_,{customer:E,totals:A,onBack:()=>w(null),onDeleteAll:T,onToggleAllPaid:k,onTogglePaid:P,onDeleteTransaction:Z,onDeleteAllPaid:I,showAddForm:u,setShowAddForm:h,formData:s,setFormData:e=>c({...s,...e}),onSubmit:D})]}):(0,a.jsxs)("div",{className:"min-h-screen pb-20",children:[g&&(0,a.jsx)(x,{type:g.type,message:g.message}),(0,a.jsx)("header",{className:"bg-gradient-to-r from-green-600 to-green-500 text-white py-6 px-4 shadow-lg",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"\uD83D\uDCCB বাকি হিসাব"}),(0,a.jsx)("p",{className:"text-green-100",children:"আপনার গ্রাহকদের বাকির হিসাব সহজে রাখুন"})]})}),(0,a.jsx)(j,{totalBaki:B,totalPaid:R,transactionCount:e.length,customerCount:S.length}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,a.jsx)("input",{type:"text",placeholder:"গ্রাহকের নাম খুঁজুন...",value:d,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all"})]})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:(0,a.jsxs)("button",{onClick:()=>h(!u),className:"w-full py-4 bg-white border-2 border-dashed border-gray-300 rounded-xl text-gray-500 hover:border-green-500 hover:text-green-600 transition-all flex items-center justify-center gap-2 font-medium",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5"}),"নতুন বিল যোগ করুন"]})}),u&&(0,a.jsx)(N,{formData:s,setFormData:e=>c({...s,...e}),onSubmit:D,onCancel:()=>h(!1)}),(0,a.jsx)(b,{customerSummaries:S,searchTerm:d,onSelectCustomer:w}),(0,a.jsx)(y,{transactions:M,onClearRecent:L,onDeleteTransaction:Z}),(0,a.jsx)("footer",{className:"max-w-4xl mx-auto px-4 mt-12 text-center text-gray-500 text-sm",children:(0,a.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," বাকি হিসাব"]})})]})}}},function(e){e.O(0,[421,971,23,744],function(){return e(e.s=754)}),_N_E=e.O()}]);